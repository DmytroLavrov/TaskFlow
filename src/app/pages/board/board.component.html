<div class="board">
  <div class="board-header">
    <div class="header-left">
      <h1>ğŸš€ TaskFlow</h1>
      @if (currentUser) {
        <span class="welcome">Hi, {{ currentUser.displayName }}! ğŸ‘‹</span>
      }
    </div>
    <button class="btn-logout" (click)="logout()">Logout ğŸšª</button>
  </div>

  <div class="board-wrapper" cdkScrollable>
    <div
      cdkDropList
      cdkDropListOrientation="horizontal"
      class="columns-list"
      (cdkDropListDropped)="dropColumn($event)"
    >
      @for (column of board.columns; track column.id; let colIndex = $index) {
        <div class="column-container" cdkDrag>
          <div class="column-header" cdkDragHandle>
            <div class="column-title-group">
              <span class="drag-handle">â‹®â‹®</span>
              <h2>{{ column.title }}</h2>
            </div>
            <button class="btn-delete-col" (click)="deleteColumn(column.id)">
              ğŸ—‘ï¸
            </button>
          </div>

          <div
            cdkDropList
            [id]="'task-list-' + colIndex"
            [cdkDropListData]="column.tasks"
            [cdkDropListConnectedTo]="getConnectedLists()"
            class="task-list"
            (cdkDropListDropped)="drop($event)"
          >
            @for (task of column.tasks; track task.id) {
              <app-task-card
                [task]="task"
                [isEditing]="editingTaskId === task.id"
                [editingTitle]="editingTaskTitle"
                (startEdit)="startEditTask(task)"
                (saveEdit)="saveEditTask(column, task)"
                (cancelEdit)="cancelEditTask()"
                (delete)="deleteTask(column.id, task.id)"
              ></app-task-card>
            }
          </div>

          <div class="add-task-footer">
            @if (activeColumnId === column.id) {
              <div class="add-form">
                <textarea
                  [(ngModel)]="newTaskTitle"
                  placeholder="Title..."
                  rows="3"
                  class="input-area"
                  (keydown.enter)="addTask(column); $event.preventDefault()"
                ></textarea>
                <div class="actions">
                  <button (click)="addTask(column)" class="btn-add">Add</button>
                  <button (click)="cancelAdd()" class="btn-close">
                    &times;
                  </button>
                </div>
              </div>
            } @else {
              <button class="btn-show-add" (click)="showAddForm(column.id)">
                + Add card
              </button>
            }
          </div>

          <div *cdkDragPlaceholder class="column-drag-placeholder"></div>
        </div>
      }

      <div class="new-column-block">
        @if (isAddingColumn) {
          <div class="new-column-form">
            <input
              [(ngModel)]="newColumnTitle"
              placeholder="List title..."
              class="input-column"
              (keydown.enter)="addColumn()"
            />
            <div class="actions">
              <button (click)="addColumn()" class="btn-add">Add List</button>
              <button (click)="isAddingColumn = false" class="btn-close">
                &times;
              </button>
            </div>
          </div>
        } @else {
          <button class="btn-add-column" (click)="isAddingColumn = true">
            + Add list
          </button>
        }
      </div>
    </div>
  </div>
</div>
